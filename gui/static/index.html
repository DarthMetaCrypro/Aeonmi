<!doctype html>
<html>
<head>
  <meta charset="utf-8" />
  <title>Aeonmi GUI Prototype</title>
  <style>
    body { margin: 0; display: flex; height: 100vh; font-family: system-ui, sans-serif; }
    #editor { width: 45%; border-right: 1px solid #ddd; height: 100%; display:flex; flex-direction:column; }
  #terminal { flex: 1; height: 100%; display:flex; flex-direction:column; position:relative; }
  #ptyList { font-size:11px; margin-left:8px; }
  #status { position:absolute; top:4px; right:8px; font-size:11px; color:#666; display:none; }
    .toolbar { padding: 6px; background: #f5f5f5; border-bottom: 1px solid #ddd; display:flex; gap:4px; align-items:center; }
    #outline { height: 140px; overflow:auto; border-bottom:1px solid #ddd; font-size: 12px; background:#fafafa; }
    #outline h4 { margin:4px 6px; font-size:11px; text-transform:uppercase; letter-spacing:0.5px; color:#555; }
    #outline ul { list-style:none; padding:0 6px 8px 6px; margin:0; }
    #outline li { padding:2px 4px; cursor:pointer; border-radius:3px; line-height:1.3; }
    #outline li:hover { background:#e3f2fd; }
    #outline li span.kind { opacity:0.7; margin-right:4px; font-size:10px; text-transform:uppercase; }
    #editorMonaco { flex:1; }
    .dim { opacity:0.6; }
  </style>
</head>
<body>
  <div id="editor">
    <div class="toolbar">
      <button id="openBtn">Open</button>
      <button id="saveBtn">Save</button>
      <input id="filePath" placeholder="path/to/file.ai" style="flex:1" />
    </div>
    <div id="outline">
      <h4>Outline</h4>
      <ul id="outlineList"><li class="dim">(empty)</li></ul>
    </div>
    <div id="editorMonaco"></div>
      <div style="margin-top:6px;">
    <button id="btnQuantumSim" title="Simulate quantum (statevector)">Quantum Sim</button>
    <label style="font-size:12px; margin-left:6px; user-select:none;"><input type="checkbox" id="autoQuantumSim" /> Auto</label>
    <button id="btnAIStream" title="AI streaming demo">AI Stream</button>
    <input id="aiPrompt" placeholder="AI prompt" style="width:220px" />
    <select id="aiHistory" style="max-width:160px;"> <option value="">(history)</option> </select>
    <button id="clearAIHist" title="Clear prompt history">✕</button>
    <label style="font-size:12px; margin-left:4px; user-select:none;"><input type="checkbox" id="autoAI" /> Auto AI</label>
  <label style="font-size:12px; margin-left:6px; user-select:none;">Hist Lim <input id="aiHistLimit" type="number" min="1" max="200" value="25" style="width:60px;" /></label>
  <button id="themeToggle" title="Toggle dark/light theme">Theme</button>
      <button id="openSettings" title="Open settings panel">Settings</button>
  <button id="codeActionsBtn" title="Show code actions at cursor">Actions</button>
  <button id="typeCheckBtn" title="Run type analysis">Type Check</button>
  <select id="aiProvider" title="AI Provider" style="max-width:120px;"><option value="">(prov)</option></select>
  <button id="showMetrics" title="Show call graph / variable metrics">Metrics</button>
      </div>
      <div id="quantumCircuitPanel" style="display:none; margin-top:6px; background:#111; color:#9cf; padding:6px; font-family:monospace; max-height:160px; overflow:auto; border:1px solid #333;">
        <div style="font-size:11px; opacity:0.8; margin-bottom:4px; display:flex; justify-content:space-between; align-items:center;">
          <span>Quantum Circuit</span>
          <button id="hideCircuit" style="background:#333; color:#fff; border:0; font-size:10px; cursor:pointer; padding:2px 6px;">Hide</button>
        </div>
  <pre id="circuitText" style="margin:0; white-space:pre;"></pre>
  <canvas id="circuitCanvas" width="400" height="140" style="margin-top:4px; background:#000; width:100%; height:140px; display:none;"></canvas>
      </div>
      <div id="aiStreamOut" style="font-family:monospace; white-space:pre-wrap; background:#111; color:#9f9; padding:4px; margin-top:4px; max-height:120px; overflow:auto; display:none;"></div>
  <div id="settingsPanel" style="display:none; position:fixed; top:60px; right:20px; width:280px; background:#222; color:#eee; border:1px solid #555; padding:10px; z-index:2000; box-shadow:0 4px 16px rgba(0,0,0,0.4); font-size:13px;">
    <div style="display:flex; justify-content:space-between; align-items:center; margin-bottom:6px;">
      <strong>Settings</strong>
      <button id="closeSettings" style="background:#444; color:#fff; border:0; padding:2px 6px; cursor:pointer;">✕</button>
    </div>
    <label style="display:block; margin-bottom:4px;">Theme:
      <select id="prefTheme">
        <option value="dark">Dark</option>
        <option value="light">Light</option>
      </select>
    </label>
    <label style="display:block; margin-bottom:4px;">AI History Limit <input id="prefHistLimit" type="number" min="1" max="200" style="width:70px;" /></label>
    <label style="display:block; margin-bottom:4px;"><input type="checkbox" id="prefAutoAI" /> Auto AI</label>
    <label style="display:block; margin-bottom:4px;"><input type="checkbox" id="prefAutoQuantum" /> Auto Quantum Sim</label>
    <div style="margin-top:8px; text-align:right;">
      <button id="savePrefs" style="background:#2a7; color:#fff; border:0; padding:4px 10px; cursor:pointer;">Save</button>
    </div>
  </div>
  <div id="metricsPanel" style="display:none; position:fixed; bottom:20px; right:20px; width:320px; max-height:280px; overflow:auto; background:#1b1e24; color:#cde; border:1px solid #445; padding:8px; font-size:12px; font-family:monospace; z-index:2100; box-shadow:0 4px 16px rgba(0,0,0,0.4);">
    <div style="display:flex; justify-content:space-between; align-items:center; margin-bottom:4px; gap:4px;">
      <strong style="font-size:12px;">Metrics</strong>
      <div style="margin-left:auto; display:flex; gap:4px;">
        <button id="resetMetrics" style="background:#444; color:#fff; border:0; padding:2px 6px; cursor:pointer; font-size:11px;" title="Reset session counters (reinfer events)">Reset</button>
        <button id="resetMetricsFull" style="background:#633; color:#fff; border:0; padding:2px 6px; cursor:pointer; font-size:11px;" title="Full reset (all metrics, deps, timings)">Full</button>
        <button id="closeMetrics" style="background:#333; color:#fff; border:0; padding:2px 6px; cursor:pointer; font-size:11px;">✕</button>
      </div>
    </div>
    <pre id="metricsContent" style="margin:0; white-space:pre-wrap;"></pre>
    <label style="display:block; margin-top:6px; font-size:11px;">
      <input type="checkbox" id="deepPropToggle" /> Deep propagation (full transitive callers)
    </label>
  </div>
  </div>
  <div id="terminal">
    <div class="toolbar">
    <select id="ptyMode"><option value="repl">Aeonmi REPL</option><option value="shell">Shell</option></select>
    <button id="startTui">Start / Stop</button>
      <button id="openNative">Open in native terminal</button>
      <select id="ptyList"></select>
    <input id="ptyTitle" placeholder="title" style="width:110px" />
    <button id="renamePty" title="Rename PTY">Rename</button>
  <button id="exportPty" title="Export PTY buffer (download)">Export</button>
  <button id="copyPty" title="Copy PTY buffer to clipboard">Copy</button>
  <button id="savePty" title="Save PTY buffer via dialog">Save As</button>
  <label style="font-size:11px; margin-left:6px; user-select:none;">
    <input type="checkbox" id="cacheLogToggle" /> Cache Log
  </label>
  <button id="exportCircuit" title="Export quantum circuit (JSON + pseudo QASM)">Export Circuit</button>
    </div>
    <div id="status">Spawning...</div>
    <div id="xterm" style="width:100%; height:calc(100% - 32px);" tabindex="0"></div>
  </div>

  <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/xterm/css/xterm.css" />
  <script src="https://cdn.jsdelivr.net/npm/xterm/lib/xterm.js"></script>
  <!-- Monaco editor loader -->
  <script src="https://cdn.jsdelivr.net/npm/monaco-editor@0.38.0/min/vs/loader.js"></script>
  <script src="main.js"></script>
</body>
</html>
